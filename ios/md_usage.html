<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BGX Mobile Framework: BGXpress Framework Usage</title>
<!-- load the fonts we want to use -->
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Roboto+Mono:400' rel='stylesheet' type='text/css'>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="silabs-logo-white.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BGX Mobile Framework
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_usage.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BGXpress Framework Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Using BGXpress.framework</h2>
<h3>Adding BGXpress to your Xcode project</h3>
<p>Add bgxpress.xcodeproj to your app's workspace file. Next, select your app in the Project Navigator in Xcode. Switch to <b>Build Phases</b> and add BGXpress to the list of target dependencies. Then add a new <b>copy files</b> build phase, choose <b>Frameworks</b> as the destination, and add BGXpress.framework to the build phase. This will allow BGXpress.framework to be built as needed and copied into your app bundle.</p>
<h3>Including the bgxpress header file</h3>
<p>In order to use the BGXpress.framework, you should include the following line:</p>
<p><code>#import &lt;bgxpress/bgxpress.h&gt;</code></p>
<h3>Using the <a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a> class</h3>
<p>The <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> class is used to interact with a BGX device. Create one of these objects in your application and store it in a place where it will be retained while your application is running. The BGXCommander app uses the <code>AppDelegate</code> class to store an instance of the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> class. Your app should do this or something that is equivalent. We recommend against using it in a <code>UIViewController</code> instance because those objects may be created and destroyed during the lifecycle of your app.</p>
<p><code>self.bgxManager = [[BSXpressManager alloc] init];</code></p>
<h3>Creating a BGXpressDelegate</h3>
<p>Your application should supply an object conforming to the <code>BGXpressDelegate</code> protocol which has a lifecycle similar to the instance of <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> you create. The BGXCommander app uses the <code>AppDelegate</code> for this purpose. The file BGXpress.h declares this protocol. The various methods in this protocol are called in order to indicate changes to the Bluetooth state, <code>ConnectionState</code>, <code>BusMode</code>. It is called when devices are discovered, data is read or data is written.</p>
<p><code>&amp;#64;interface MyDelegate : <a class="el" href="class_n_s_object-p.html">NSObject</a> &lt;BGXpressDelegate&gt;</code></p>
<p><code>self.myDelegate = [[MyDelegate alloc] init];</code></p>
<p><code>self.bgxManager.delegate = self.myDelegate;</code></p>
<h4>Device Discovery</h4>
<p>To discover devices you must wait until the Bluetooth state is <code>CBManagerStatePoweredOn</code>. You can detect this by implementing the method <code>-(void)bluetoothStateChanged:(CBManagerState)state</code> in your <code>BGXpressDelegate</code> class. After you have received this notification, call:</p>
<p><code>[self.bgxManager startScan];</code></p>
<p>As BGX devices are discovered, the <code>-(void)deviceDiscovered</code> method is called. When this happens, you can access the list of devices using the <code>devicesDiscovered</code> property of your <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> instance.</p>
<p>When you wish to stop scanning call:</p>
<p><code>[self.bgxManager stopScan];</code></p>
<p>Note that if BGX devices are turned off or move out of range they are not automatically removed from the <code>discoveredDevices</code> array. When you call startScan, the <code>discoveredDevices</code> array is emptied of devices. One way to ensure that your list of devices is not stale is to periodically stop scanning and the scan again.</p>
<h4>Connecting to a BGX</h4>
<p>To connect to a specific BGX device, call the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> method <code>- (BOOL)connectToDevice:(NSString *)deviceName</code> using the device name. The call will return <code>YES</code> if the device is in the list and the connectionState of the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> is <code>SCANNING</code> or <code>DISCONNECTED</code>; otherwise it will return <code>NO</code> meaning that no connection attempt will occur. This call is asynchronous. To detect when the connection occurs, the <code>BGXpressDelegate</code> for your <a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a> will be called using the method <code>- (void)connectionStateChanged:(ConnectionState)newConnectionState;</code> When this is called with the value of <code>CONNECTED</code>, the connection has finished.</p>
<p>Note that BGX devices only support one connection at a time when they are acting as a peripheral.</p>
<h4>Detecting device changes</h4>
<p>The <code>BGXpressDelegate</code> for your <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> will be called when certain events occur related to the connected device. For example, the method <code>- (void)dataRead:(NSData *)newData</code> is called when data is received by the BGX.</p>
<h4>Read/Write Serial data</h4>
<p>To write serial data to a connected BGX device, the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> method</p>
<h4>Bus Mode</h4>
<p>To read the <code>BusMode</code>, call the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> method <code>- (BOOL)readBusMode;</code>. This method will return YES if the <code>BusMode</code> can be read. When it is read, the <code>BGXpressDelegate</code> method <code>- (void)busModeChanged:(BusMode)newBusMode</code> will be called.</p>
<p>To change the <code>BusMode</code>, call the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> method <code>- (BOOL)writeBusMode:(BusMode)newBusMode;</code> The call will return <code>YES</code> if the <code>BusMode</code> can be written. When the write has completed, the <code>BGXpressDelegate</code> delegate method <code>- (void)busModeChanged:(BusMode)newBusMode</code> will be called.</p>
<h4>Disconnecting from a BGX</h4>
<p>To disconnect from the currently connected BGX device, call the <code><a class="el" href="group__bgx__framework.html#interface_b_g_xpress_manager" title="This class is used to interact with a BGX device. ">BGXpressManager</a></code> method <code>- (BOOL)disconnect;</code>. This method returns <code>YES</code> if the disconnect operation can be performed (i.e. a device is connected or connecting). The call is asynchronous. When the disconnect is complete, your <code>BGXpressDelegate</code> method <code>- (void)connectionStateChanged:(ConnectionState)newConnectionState;</code> will be called.</p>
<h3>Firmware Update</h3>
<p>Updating the firmware on a BGX device involves the following steps:</p>
<ol type="1">
<li>Select the BGX you wish to update.</li>
<li>Get a list of available firmware for the device.</li>
<li>Retrieve the image of the firmware to be installed.</li>
<li>Install it on the BGX.</li>
</ol>
<h4>Get available firmware using DMS</h4>
<p>To get a list of available firmware, first use the unique device id for the BGX to create an instance of <code><a class="el" href="group__bgx__dms.html#interfacebgx__dms" title="bgx_dms is used to get a list of firmware versions that are compatible with your BGX device and to do...">bgx_dms</a></code>:</p>
<p><code>self.bgx_dms = [[<a class="el" href="group__bgx__dms.html#interfacebgx__dms" title="bgx_dms is used to get a list of firmware versions that are compatible with your BGX device and to do...">bgx_dms</a> alloc] initWithBGXUniqueDeviceID: self.bgxpressManager.device_unique_id];</code></p>
<p>Then call the method </p><pre class="fragment">`- (void)retrieveAvailableVersions:(void (^)(NSError *, NSArray *))completionBlock;` 
</pre><p> to get the available firmware for the BGX.</p>
<p>The completion block will be called with an array of <code>NSDictionary</code> objects representing firmware versions. Each <code>NSDictionary</code> will contain a <em>version</em> (NSString), a <em>tag</em> (NSString), and a <em>size</em> (NSNumber). <br />
 Note that this operation requires the DMS server to be reachable by your iOS device. When the DMS server becomes rechable or unreachable, the notification <code>DMSServerReachabilityChangedNotificationName</code> will be sent with an object of an <code>NSNumber</code> containing a boolean. <code>YES</code> indicates reachable; <code>NO</code> indicates not reachable. You can register to receive this notification using the default NSNotificationCenter. You may receive this notication anytime after you create an instance of <code><a class="el" href="group__bgx__dms.html#interfacebgx__dms" title="bgx_dms is used to get a list of firmware versions that are compatible with your BGX device and to do...">bgx_dms</a></code>. Therefore, you should register for the notification before creating a <code><a class="el" href="group__bgx__dms.html#interfacebgx__dms" title="bgx_dms is used to get a list of firmware versions that are compatible with your BGX device and to do...">bgx_dms</a></code> instance.</p>
<h4>Get firmware image using DMS</h4>
<p>To retrieve a specific firmware image, use the </p><pre class="fragment">`- (void)loadFirmwareVersion:(NSString *)version completion:(void (^)(NSError *, NSString * firmware_path))completionBlock;` 
</pre><p>method. The completion routine will be called with the absolute path to the file containing the firmware image.</p>
<p>You can use the same image to update the firmware on more than one BGX provided they are have the same part id. To determine the part id, use the <code><a class="el" href="group__bgx__dms.html#interfacebgx__dms" title="bgx_dms is used to get a list of firmware versions that are compatible with your BGX device and to do...">bgx_dms</a></code> method</p>
<p><code>+ (NSString *)bgxPartInfoForDeviceID:(NSString *)device_uuid;</code></p>
<h4>Updating a BGX using a firmware image</h4>
<p>To update a BGX using a firmware image:</p>
<ol type="1">
<li>Create an instance of <code><a class="el" href="group__bgx__ota.html#interface_b_g_x___o_t_a___updater" title="Performs OTA operations on a BGX device. ">BGX_OTA_Updater</a></code>.</li>
<li>Use KVO to observe changes to the properties you are interested in. This will usually be the <code>operationInProgress</code> property, the <code>ota_step</code> property, and the <code>upload_progress</code> property.</li>
<li>Call <code>- (void)updateFirmwareWithImageAtPath:(NSString *)path2FWImage withVersion:(NSString *)version</code>.</li>
</ol>
<p>The simplest way to detect that the firmware update has finished is that the <code>operationsInProgress</code> property has the value <code>ota_firmware_update_complete</code>. The value of <code>ota_step</code> will be <code>ota_step_end</code> when the update has completed without error. </p>
</div><div style="border-top: 1px solid #c0c0c0; margin-top: 8px; font-size: 12px; color: #c0c0c0;"><span style="float: left;">Copyright 2018 Silicon Labs</span><span style="float: right">536bbb94 Tue Sep 11 14:27:22 CDT 2018</span></div></div><!-- pagefooter-contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
</body>
</html>
